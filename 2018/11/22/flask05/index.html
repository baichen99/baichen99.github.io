<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="https://s2.ax1x.com/2019/06/13/VhRMGV.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="https://s2.ax1x.com/2019/06/13/VhRMGV.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="https://s2.ax1x.com/2019/06/13/VhRMGV.png?v=5.1.4">


  <link rel="mask-icon" href="https://s2.ax1x.com/2019/06/13/VhRMGV.pngg?v=5.1.4" color="#222">





  <meta name="keywords" content="flask,表单,forms," />










<meta name="description" content="表单html表单在html表单中，&lt;input&gt;标签表示各种输入字段，&lt;label&gt;标签则用文字来定义字段的标签文字。 123456789&lt;form mehtod&#x3D;&quot;post&quot;&gt;    &lt;label for&#x3D;&quot;username&quot;&gt;Username&lt;&#x2F;label&gt;&lt;&#x2F;br&gt;    &lt;">
<meta property="og:type" content="article">
<meta property="og:title" content="flask05-表单">
<meta property="og:url" content="http://blacston.com/2018/11/22/flask05/index.html">
<meta property="og:site_name" content="黑石的技术笔记">
<meta property="og:description" content="表单html表单在html表单中，&lt;input&gt;标签表示各种输入字段，&lt;label&gt;标签则用文字来定义字段的标签文字。 123456789&lt;form mehtod&#x3D;&quot;post&quot;&gt;    &lt;label for&#x3D;&quot;username&quot;&gt;Username&lt;&#x2F;label&gt;&lt;&#x2F;br&gt;    &lt;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2018/11/22/FPNu9J.png">
<meta property="og:image" content="https://s1.ax1x.com/2018/11/22/FPNQj1.png">
<meta property="article:published_time" content="2018-11-22T05:17:00.000Z">
<meta property="article:modified_time" content="2021-01-16T03:39:21.274Z">
<meta property="article:author" content="baichen">
<meta property="article:tag" content="flask">
<meta property="article:tag" content="表单">
<meta property="article:tag" content="forms">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2018/11/22/FPNu9J.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blacston.com/2018/11/22/flask05/"/>





  <title>flask05-表单 | 黑石的技术笔记</title>
  








<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">黑石的技术笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blacston.com/2018/11/22/flask05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="黑石的技术笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">flask05-表单</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-22T13:17:00+08:00">
                2018-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flask%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">flask学习笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><h2 id="html表单"><a href="#html表单" class="headerlink" title="html表单"></a>html表单</h2><p>在html表单中，<code>&lt;input&gt;</code>标签表示各种输入字段，<code>&lt;label&gt;</code>标签则用文字来定义字段的标签文字。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">mehtod</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;1414124&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remenber&quot;</span> <span class="attr">id</span>=<span class="string">&quot;remember&quot;</span> <span class="attr">checked</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;remenber&quot;</span>&gt;</span>Remember me<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="WTForms"><a href="#WTForms" class="headerlink" title="WTForms"></a>WTForms</h2><p>WTForms支持在python中使用<strong>类</strong>来定义表单，然后通过类定义生成对应的html代码，这种方式方面，易于重用，所以一般不会再模板中直接使用html编写表单。</p>
<h2 id="使用Flask-WTF处理表单"><a href="#使用Flask-WTF处理表单" class="headerlink" title="使用Flask-WTF处理表单"></a>使用Flask-WTF处理表单</h2><p>Flask-WTF集成了WTForms使用它可以在flask中更方便地使用WTFormss。Flask-WTF将表单数据解析，CSRF保护，文件上传等功能与flask集成，还增加了reCAPTCHA支持。</p>
<p>安装Flask-WTF及其依赖<br><code>$ pipenv install flask-wtf</code></p>
<p>Flask-WTF默认为每个表单启用CSRF保护，他会为我们自动生成和验证CSRF令牌。默认情况使用程序密钥来对令牌进行签名，配置键<code>WTF_CSRF_ENABLED</code>来设置是否开启CSRF保护，默认为True。flask-wtf会自动在实例化表单类时添加一个包含CSRF令牌值的<em>隐藏字段</em>，字段名为<code>cstf_token</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.secret_key &#x3D; &#39;secret string&#39;</span><br></pre></td></tr></table></figure>
<h3 id="定义WTForms表单类"><a href="#定义WTForms表单类" class="headerlink" title="定义WTForms表单类"></a>定义WTForms表单类</h3><p>当使用WTForms创建表单时，表单由python来表示，这个类继承从WTForms导入Form基类。一个表单由若干输入字段(Field)组成，字段由表单类的类属性表示。下面自定义了一个LoginForm类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> Form, StringField, PasswordField, BooleanField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtfroms.validators <span class="keyword">import</span> DataRequired, Length</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">Form</span>):</span></span><br><span class="line">    username = StringField(<span class="string">&#x27;Username&#x27;</span>, validators=[DataRequired()])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;Password&#x27;</span>, validators=[DataRequired(), Length(<span class="number">8</span>, <span class="number">128</span>)])</span><br><span class="line">    remember = BooleanField(<span class="string">&#x27;Remember me&#x27;</span>)</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;Login&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>每隔字段属性通过实例化WTForms提供的字段表示，字段属性的名称将作为对应input元素的name属性和id属性。</br><br>字段名称大小写敏感，不能以下划线和validate开头。</p>
<h3 id="常用WTForms字段"><a href="#常用WTForms字段" class="headerlink" title="常用WTForms字段"></a>常用WTForms字段</h3><p><img src="https://s1.ax1x.com/2018/11/22/FPNu9J.png"></p>
<h3 id="实例化字段类常用参数"><a href="#实例化字段类常用参数" class="headerlink" title="实例化字段类常用参数"></a>实例化字段类常用参数</h3><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">label</td>
<td align="center">字段标签<label>的值，也就是渲染后显示在输入字段前的文字</td>
</tr>
<tr>
<td align="left">render_kw</td>
<td align="center">一个字典，用来设置对应input标签的属性</td>
</tr>
<tr>
<td align="left">valiadtors</td>
<td align="center">一个列表，包含一系列验证器，会在表单提交后被逐一调用验证表单数据</td>
</tr>
<tr>
<td align="left">default</td>
<td align="center">字符串或可调用对象，用来为表单字段设置默认值</td>
</tr>
</tbody></table>
<h3 id="常用WTForms验证器"><a href="#常用WTForms验证器" class="headerlink" title="常用WTForms验证器"></a>常用WTForms验证器</h3><p><img src="https://s1.ax1x.com/2018/11/22/FPNQj1.png"></p>
<p>验证器的第一个参数一般为促物体时消息，可以使用message参数传入错误消息来覆盖内置消息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name &#x3D; StringField(&#39;Your name&#39;, validators&#x3D;[DataRequired(message&#x3D;u&quot;名字不能为空&quot;)])</span><br></pre></td></tr></table></figure>
<h3 id="使用Flask-WTF"><a href="#使用Flask-WTF" class="headerlink" title="使用Flask-WTF"></a>使用Flask-WTF</h3><p>使用Flask-WTF定义表单时，<strong>仍然使用WTForms提供的字段类和验证器</strong>，只不过表单类药继承Flask-WTF提供的FlaskForm类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from flask-wtf import FlaskForm</span><br><span class="line">from wtforms import StringField, PasswordField, BooleanField, SubmitField</span><br><span class="line">from wtfroms.validators import DataRequired, Length</span><br><span class="line">class LoginForm(FlaskForm):</span><br><span class="line">    username &#x3D; StringField(&#39;Username&#39;, validators&#x3D;[DataRequired()])</span><br><span class="line">    password &#x3D; PasswordField(&#39;Password&#39;, validators&#x3D;[DataRequired(), Length(8, 128)])</span><br><span class="line">    remember &#x3D; BooleanField(&#39;Remember me&#39;)</span><br><span class="line">    submit &#x3D; SubmitField(&#39;Login&#39;)</span><br></pre></td></tr></table></figure>
<h2 id="输出html代码"><a href="#输出html代码" class="headerlink" title="输出html代码"></a>输出html代码</h2><p>实例化表单类，然后将实例属性转换成字符串或直接调用获取表单字段对应的html代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; form &#x3D; LoginForm()</span><br><span class="line">&gt;&gt;&gt; form.username()</span><br><span class="line">u&#39;&lt;input id&#x3D;&quot;username&quot; name&#x3D;&quot;username&quot; type&#x3D;&quot;text&quot; value&#x3D;&quot;&quot;&gt;&#39;</span><br></pre></td></tr></table></figure>
<p>字段的label元素的html代码可以通过<code>form.字段名.label</code>的形式获取</p>
<h3 id="为字段添加额外属性"><a href="#为字段添加额外属性" class="headerlink" title="为字段添加额外属性"></a>为字段添加额外属性</h3><h4 id="使用render-kw属性"><a href="#使用render-kw属性" class="headerlink" title="使用render_kw属性"></a>使用render_kw属性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username &#x3D; StringField(&#39;Username&#39;, render_kw&#x3D;&#123;&#39;placeholder&#39;:&#39;Your name&#39;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="在调用字段时传入"><a href="#在调用字段时传入" class="headerlink" title="在调用字段时传入"></a>在调用字段时传入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">form.username(style&#x3D;&#39;width: 200px;&#39;, class_&#x3D;&#39;bar&#39;)</span><br></pre></td></tr></table></figure>
<p>用class_代替class，渲染后的input标签会获取正确的class属性。</p>
<h2 id="在模板中渲染表单"><a href="#在模板中渲染表单" class="headerlink" title="在模板中渲染表单"></a>在模板中渲染表单</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from forms import LoginForm</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;basic&#39;)</span><br><span class="line">def basic():</span><br><span class="line">    form &#x3D; LoginForm()</span><br><span class="line">    return render_template(&#39;login.html&#39;, form&#x3D;form)</span><br></pre></td></tr></table></figure>
<p>在模板中通过调用属性获取字段对应的html代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">    &#123;&#123; form.csrf_token &#125;&#125;</span><br><span class="line">    &#123;&#123; form.username.label &#125;&#125;  &#123;&#123; from.username &#125;&#125;&lt;&#x2F;br&gt;</span><br><span class="line">    &#123;&#123; form.password.label &#125;&#125;  &#123;&#123; form.password &#125;&#125;&lt;&#x2F;br&gt;</span><br><span class="line">    &#123;&#123; form.remember &#125;&#125;  &#123;&#123;form.remember.label&#125;&#125;&lt;&#x2F;br&gt;</span><br><span class="line">    &#123;&#123; form.submit &#125;&#125;&lt;&#x2F;br&gt;</span><br><span class="line">    </span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>
<p>csrf_token在提交表单后会被自动验证，为了确保表单通过验证，必须在表单中手动渲染这个字段。</p>
<h2 id="处理表单数据"><a href="#处理表单数据" class="headerlink" title="处理表单数据"></a>处理表单数据</h2><ol>
<li>解析请求，获取表单数据</li>
<li>对数据进行必要的转换</li>
<li>验证数据和CSRF令牌</li>
<li>如果验证未通过则生成错误消息</li>
<li>如果通过验证则把数据保存到数据库或做进一步处理</li>
</ol>
<h3 id="提交表单"><a href="#提交表单" class="headerlink" title="提交表单"></a>提交表单</h3><form>标签的提交行为主要由三个属性控制。

<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="center">默认值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">action</td>
<td align="center">当前url</td>
<td align="left">表单提交时发送请求的url</td>
</tr>
<tr>
<td align="left">method</td>
<td align="center">get</td>
<td align="left">提交方法，仅支持get和post</td>
</tr>
<tr>
<td align="left">enctype</td>
<td align="center">application/x-www-form-urlencoded</td>
<td align="left">表单编码类型</td>
</tr>
</tbody></table>
<h3 id="验证表单数据"><a href="#验证表单数据" class="headerlink" title="验证表单数据"></a>验证表单数据</h3><h4 id="wtforms验证机制"><a href="#wtforms验证机制" class="headerlink" title="wtforms验证机制"></a>wtforms验证机制</h4><p>实例化表单类时传入表单数据，然后对表单实例调用<code>validate()</code>方法。这会对每个字段调用相应的验证器，返回验证结果的布尔值。如果验证失败，就把错误消息储存到表单实例的errors属性对应的字典中。</p>
<hr>
<p>注意：使用post方法提交的表单数据会被解析成一个字典，可以通过<code>request.form</code>获取。使用get方法提交的数据同样被解析成字典，通过<code>request.args</code>获取。</p>
<hr>
<h4 id="在视图函数中验证表单"><a href="#在视图函数中验证表单" class="headerlink" title="在视图函数中验证表单"></a>在视图函数中验证表单</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if request.method&#x3D;&#x3D;&#39;POST&#39; and form.validate(): </span><br></pre></td></tr></table></figure>
<p>Flask-WTF提供的<code>validate_on_submit()</code>合并了这两个操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if form.validate_on_submit(): </span><br></pre></td></tr></table></figure>
<p>通过form.字段名.date获取对应字段的数据。</p>
<h4 id="Post-Redirect-Get"><a href="#Post-Redirect-Get" class="headerlink" title="Post/Redirect/Get"></a>Post/Redirect/Get</h4><p>在浏览器中，刷新/重载时的默认行为时发送上一个请求，如果上一个请求时post，那么就会弹出一个窗口，询问用户是否再次提交此表单，为了避免这个提示，我们尽量不要让post请求作为最后一个请求，所以我们在处理表单后返回一个重定向响应，让浏览器发送一个get请求到相应url。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">@app.route(&#39;&#x2F;basic&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def basic():</span><br><span class="line">    form &#x3D; LoginForm()</span><br><span class="line">    if form.validate_on_submit():</span><br><span class="line">        username &#x3D; form.username.data</span><br><span class="line">        flash(&quot;Welcome Home %s&quot;, % username)</span><br><span class="line">        return redirect(url_for(&#39;index&#39;))</span><br><span class="line">    return render_template(&#39;basic.html&#39;, form&#x3D;form)</span><br></pre></td></tr></table></figure>
<h3 id="在模板中渲染错误消息"><a href="#在模板中渲染错误消息" class="headerlink" title="在模板中渲染错误消息"></a>在模板中渲染错误消息</h3><p>我们一般会通过字段名来获取<strong>对应字段的错误消息列表</strong>，即<code>form.字段名.errors</code>。</p>
<h2 id="自定义验证器"><a href="#自定义验证器" class="headerlink" title="自定义验证器"></a>自定义验证器</h2><h3 id="行内验证器"><a href="#行内验证器" class="headerlink" title="行内验证器"></a>行内验证器</h3><p>当表单类中包含以<code>validate_字段属性名</code>形式命名的方法时，在验证字段数据时会同时调用这个方法来验证对应的字段。验证方法接收两个位置参数，以此为form和field，分别是表单类实例和字段对象。验证出错跑出从<code>wtforms.validators</code>模块导入的<code>ValidatorError</code>异常。</p>
<p>注：不需要传入参数时使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from wtforms import IntegetField, SubmitField</span><br><span class="line">from wtforms.validators import ValidationError</span><br><span class="line"></span><br><span class="line">class FourtyTwoForm(FlaskForm):</span><br><span class="line">    answer &#x3D; IntegerField(&#39;The Number&#39;)</span><br><span class="line">    submit &#x3D; SubmitField()</span><br><span class="line">    </span><br><span class="line">    def validate_answer(form, field):</span><br><span class="line">        if field.data !&#x3D; 42:</span><br><span class="line">            raise VlidationError(&quot;Must be 42&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="全局验证器"><a href="#全局验证器" class="headerlink" title="全局验证器"></a>全局验证器</h3><p>如果想定义一个可重用的验证器，可以通过一个函数实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def is_42(message&#x3D;None):</span><br><span class="line">    if message is None:</span><br><span class="line">        message &#x3D; &#39;Must be 42&#39;</span><br><span class="line">    def _is_42(form, field):</span><br><span class="line">        if field.data !&#x3D; 42:</span><br><span class="line">            raise ValidationError(message)</span><br><span class="line">    </span><br><span class="line">    return _is_42</span><br><span class="line">            </span><br></pre></td></tr></table></figure>
<p>注意：自定义验证器要返回可调用对象</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/flask/" rel="tag"># flask</a>
          
            <a href="/tags/%E8%A1%A8%E5%8D%95/" rel="tag"># 表单</a>
          
            <a href="/tags/forms/" rel="tag"># forms</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/12/fenci/" rel="next" title="中文分词正向最大匹配算法(C++)">
                <i class="fa fa-chevron-left"></i> 中文分词正向最大匹配算法(C++)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/24/flask06/" rel="prev" title="flask06-数据库">
                flask06-数据库 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">68</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95"><span class="nav-number">1.</span> <span class="nav-text">表单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#html%E8%A1%A8%E5%8D%95"><span class="nav-number">2.</span> <span class="nav-text">html表单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WTForms"><span class="nav-number">3.</span> <span class="nav-text">WTForms</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Flask-WTF%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95"><span class="nav-number">4.</span> <span class="nav-text">使用Flask-WTF处理表单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89WTForms%E8%A1%A8%E5%8D%95%E7%B1%BB"><span class="nav-number">4.1.</span> <span class="nav-text">定义WTForms表单类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8WTForms%E5%AD%97%E6%AE%B5"><span class="nav-number">4.2.</span> <span class="nav-text">常用WTForms字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="nav-number">4.3.</span> <span class="nav-text">实例化字段类常用参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8WTForms%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="nav-number">4.4.</span> <span class="nav-text">常用WTForms验证器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Flask-WTF"><span class="nav-number">4.5.</span> <span class="nav-text">使用Flask-WTF</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%87%BAhtml%E4%BB%A3%E7%A0%81"><span class="nav-number">5.</span> <span class="nav-text">输出html代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E5%AD%97%E6%AE%B5%E6%B7%BB%E5%8A%A0%E9%A2%9D%E5%A4%96%E5%B1%9E%E6%80%A7"><span class="nav-number">5.1.</span> <span class="nav-text">为字段添加额外属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8render-kw%E5%B1%9E%E6%80%A7"><span class="nav-number">5.1.1.</span> <span class="nav-text">使用render_kw属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E8%B0%83%E7%94%A8%E5%AD%97%E6%AE%B5%E6%97%B6%E4%BC%A0%E5%85%A5"><span class="nav-number">5.1.2.</span> <span class="nav-text">在调用字段时传入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E6%B8%B2%E6%9F%93%E8%A1%A8%E5%8D%95"><span class="nav-number">6.</span> <span class="nav-text">在模板中渲染表单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="nav-number">7.</span> <span class="nav-text">处理表单数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E8%A1%A8%E5%8D%95"><span class="nav-number">7.1.</span> <span class="nav-text">提交表单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="nav-number">7.2.</span> <span class="nav-text">验证表单数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#wtforms%E9%AA%8C%E8%AF%81%E6%9C%BA%E5%88%B6"><span class="nav-number">7.2.1.</span> <span class="nav-text">wtforms验证机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%E4%B8%AD%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95"><span class="nav-number">7.2.2.</span> <span class="nav-text">在视图函数中验证表单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Post-Redirect-Get"><span class="nav-number">7.2.3.</span> <span class="nav-text">Post&#x2F;Redirect&#x2F;Get</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E6%B8%B2%E6%9F%93%E9%94%99%E8%AF%AF%E6%B6%88%E6%81%AF"><span class="nav-number">7.3.</span> <span class="nav-text">在模板中渲染错误消息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="nav-number">8.</span> <span class="nav-text">自定义验证器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E5%86%85%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="nav-number">8.1.</span> <span class="nav-text">行内验证器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="nav-number">8.2.</span> <span class="nav-text">全局验证器</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">baichen</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  


  

  

</body>
</html>
